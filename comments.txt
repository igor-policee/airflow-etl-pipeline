Привет!
Хочу отметить, что методология расчета витрины mart.f_customer_retention, описанная на сайте ЯП, с моей точки зрения, не позволяет посчитать требуемые метрики.
Например, условие: " клиент сделал только один заказ за указанный период " не поможет посчитать новых клиентов. 
Более того, если дословно следовать описанной методологии, то мы столкнемся с тем, что вернувшихся клиентов (которые сделали более одного заказа за указанный период) больше чем новых клиентов (которые сделали только один заказ).
Также не понятно, что должно быть в поле item_id. Я, конечно, могу собрать все item_id в массив, но это вряд ли сделает витрину более информативной.

В итоге я расчитал метрики по другой методологии.
